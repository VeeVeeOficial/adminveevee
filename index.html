<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeeVee Admin Panel - Perfect Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, addDoc, query, orderBy, limit, where, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAlUUr6ATEfDQohr5Zvdk5_C7xKJFBLem0",
            authDomain: "veeveeweb.firebaseapp.com",
            projectId: "veeveeweb",
            storageBucket: "veeveeweb.firebasestorage.app",
            messagingSenderId: "105473827182",
            appId: "1:105473827182:web:d91d4b3bb2e91d8f456a3b"
        };

        try {
            const app = initializeApp(firebaseConfig);
            const db = getFirestore(app);
            const auth = getAuth(app);

            window.firebaseDb = db;
            window.firebaseAuth = auth;
            window.firebaseCollection = collection;
            window.firebaseGetDocs = getDocs;
            window.firebaseAddDoc = addDoc;
            window.firebaseDoc = doc;
            window.firebaseUpdateDoc = updateDoc;
            window.firebaseDeleteDoc = deleteDoc;
            window.firebaseQuery = query;
            window.firebaseOrderBy = orderBy;
            window.firebaseLimit = limit;
            window.firebaseWhere = where;
            window.firebaseServerTimestamp = serverTimestamp;
            window.firebaseSignInWithEmailAndPassword = signInWithEmailAndPassword;
            window.firebaseSignOut = signOut;
            
            window.firebaseOnAuthStateChanged = function(auth, callback) {
                try {
                    return onAuthStateChanged(auth, callback);
                } catch (error) {
                    console.error('‚ùå Firebase onAuthStateChanged error:', error);
                    setTimeout(() => callback(null), 100);
                    return () => {};
                }
            };

            window.firebaseOnAuthStateChanged(auth, (user) => {
                if (user) {
                    console.log('‚úÖ Firebase Auth: User is signed in:', user.email);
                    
                    setTimeout(() => {
                        const adminApp = document.querySelector('[x-data="adminApp"]');
                        if (adminApp && adminApp._x_dataStack) {
                            const data = adminApp._x_dataStack[0];
                            if (data) {
                                data.isAuthenticated = true;
                                data.userEmail = user.email;
                                console.log('‚úÖ Admin state updated via Alpine');
                                
                                if (typeof data.loadAllData === 'function') {
                                    data.loadAllData();
                                }
                            }
                        }
                    }, 500);
                } else {
                    console.log('üö™ Firebase Auth: User is signed out');
                }
            });

            console.log('‚úÖ Firebase Admin initialized successfully');

        } catch (error) {
            console.error('‚ùå Firebase initialization failed:', error);
            
            window.firebaseDb = null;
            window.firebaseAuth = null;
            window.firebaseOnAuthStateChanged = function(auth, callback) {
                console.warn('‚ö†Ô∏è Firebase not available, using fallback');
                setTimeout(() => callback(null), 100);
                return () => {};
            };
            
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö');
        }
    </script>

    <style>
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.6s ease-out;
        }
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .loading {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            min-width: 300px;
            max-width: 500px;
            padding: 16px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
        }
        .notification.show {
            transform: translateX(0);
        }
        .notification.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .notification.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .notification.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>

<body class="bg-gray-50" x-data="adminApp">
    
    <!-- Notification System -->
    <div id="notification" class="notification">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i id="notification-icon" class="mr-2"></i>
                <span id="notification-message"></span>
            </div>
            <button onclick="hideNotification()" class="ml-4 text-gray-500 hover:text-gray-700">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- Login Screen -->
    <div x-show="!isAuthenticated" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-green-400 to-blue-500">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-96">
            <div class="text-center mb-6">
                <div class="w-16 h-16 bg-green-100 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-leaf text-green-600 text-2xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">VeeVee Admin</h1>
                <p class="text-gray-600">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏á‡∏ö‡πâ‡∏≤‡∏ô</p>
            </div>
            
            <form @submit.prevent="login" class="space-y-4">
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
                    <input type="email" x-model="loginForm.email" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <div>
                    <label class="block text-gray-700 font-semibold mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
                    <input type="password" x-model="loginForm.password" required
                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                </div>
                
                <button type="submit" :disabled="loginLoading"
                        class="w-full bg-green-500 text-white py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors disabled:opacity-50 flex items-center justify-center">
                    <span x-show="!loginLoading">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
                    <span x-show="loginLoading" class="flex items-center">
                        <div class="loading mr-2"></div>
                        ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...
                    </span>
                </button>
            </form>
            
            <div x-show="loginError" x-text="loginError" class="mt-4 p-3 bg-red-100 text-red-700 rounded-lg"></div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div x-show="isAuthenticated" class="min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-green-100 rounded-lg mr-3 flex items-center justify-center">
                            <i class="fas fa-leaf text-green-600"></i>
                        </div>
                        <h1 class="text-2xl font-bold text-gray-900">VeeVee Admin</h1>
                        <span class="ml-4 px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">
                            <i class="fas fa-circle text-green-500 text-xs mr-1"></i>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå
                        </span>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <button @click="openGoogleSheets()" class="bg-green-500 text-white px-3 py-1 rounded hover:bg-green-600 transition-colors text-sm">
                            <i class="fas fa-table mr-1"></i>Google Sheets
                        </button>
                        <div class="text-right">
                            <div class="text-sm text-gray-500">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ</div>
                            <div class="text-sm font-medium text-gray-900" x-text="userEmail"></div>
                        </div>
                        <button @click="logout" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors">
                            <i class="fas fa-sign-out-alt mr-2"></i>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex space-x-8 overflow-x-auto">
                    <button @click="currentTab = 'slips'" 
                            :class="currentTab === 'slips' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        <i class="fas fa-receipt mr-2"></i>‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô
                        <span class="ml-2 bg-red-100 text-red-800 text-xs rounded-full px-2 py-1" x-text="pendingSlips"></span>
                    </button>
                    
                    <button @click="currentTab = 'orders'" 
                            :class="currentTab === 'orders' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        <i class="fas fa-shopping-cart mr-2"></i>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                        <span class="ml-2 bg-blue-100 text-blue-800 text-xs rounded-full px-2 py-1" x-text="orders.length"></span>
                    </button>
                    
                    <button @click="currentTab = 'inventory'" 
                            :class="currentTab === 'inventory' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        <i class="fas fa-warehouse mr-2"></i>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å
                        <span class="ml-2 bg-yellow-100 text-yellow-800 text-xs rounded-full px-2 py-1" x-text="getTotalStock()"></span>
                    </button>
                    
                    <button @click="currentTab = 'pos'" 
                            :class="currentTab === 'pos' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        <i class="fas fa-cash-register mr-2"></i>POS ‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô
                        <span class="ml-2 bg-green-100 text-green-800 text-xs rounded-full px-2 py-1">‡πÄ‡∏õ‡∏¥‡∏î</span>
                    </button>
                    
                    <button @click="currentTab = 'contacts'" 
                            :class="currentTab === 'contacts' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        <i class="fas fa-envelope mr-2"></i>‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠
                        <span class="ml-2 bg-blue-100 text-blue-800 text-xs rounded-full px-2 py-1" x-text="contacts.length"></span>
                    </button>
                    
                    <button @click="currentTab = 'reports'" 
                            :class="currentTab === 'reports' ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'"
                            class="py-4 px-1 border-b-2 font-medium text-sm whitespace-nowrap">
                        <i class="fas fa-chart-line mr-2"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>
        </nav>

        <!-- Content -->
        <main class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8">
            
            <!-- Loading Overlay -->
            <div x-show="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div class="bg-white p-6 rounded-lg shadow-lg text-center">
                    <div class="loading mx-auto mb-4" style="width: 40px; height: 40px;"></div>
                    <p class="text-gray-700">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
                </div>
            </div>

            <!-- ========================== -->
            <!-- üßæ PAYMENT SLIPS TAB -->
            <!-- ========================== -->
            <div x-show="currentTab === 'slips' && !loading">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">üßæ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h2>
                        <p class="text-gray-600 mt-1">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‡∏•‡∏ö ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</p>
                    </div>
                    <div class="flex space-x-3">
                        <button @click="refreshPaymentSlips()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                        <button @click="bulkApproveSlips()" :disabled="pendingSlips === 0" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50">
                            <i class="fas fa-check-double mr-2"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
                
                <!-- Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i class="fas fa-receipt text-blue-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="paymentSlips.length"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <i class="fas fa-clock text-yellow-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="pendingSlips"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <i class="fas fa-check-circle text-green-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="approvedSlips"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-purple-100 rounded-lg">
                                <i class="fas fa-money-bill-wave text-purple-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="'‡∏ø' + getTodaySlipAmount().toLocaleString()"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Slips Grid -->
                <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
                    <template x-for="slip in paymentSlips" :key="slip.id">
                        <div class="bg-white shadow-sm rounded-lg overflow-hidden hover:shadow-md transition-shadow">
                            <!-- Slip Image -->
                            <div class="h-48 bg-gray-100 flex items-center justify-center relative">
                                <template x-if="slip.file_data || slip.image_url">
                                    <img :src="slip.image_url || ('data:' + slip.file_type + ';base64,' + slip.file_data)" 
                                         class="max-h-full max-w-full object-contain cursor-pointer" 
                                         alt="Payment Slip"
                                         @click="viewSlipImage(slip)">
                                </template>
                                <template x-if="!slip.file_data && !slip.image_url">
                                    <div class="text-gray-400">
                                        <i class="fas fa-image text-4xl mb-2"></i>
                                        <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</p>
                                    </div>
                                </template>
                                
                                <!-- Status Badge -->
                                <div class="absolute top-2 right-2">
                                    <span x-show="slip.verification_status === 'pending'" class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs font-medium">
                                        <i class="fas fa-clock mr-1"></i>‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
                                    </span>
                                    <span x-show="slip.verification_status === 'approved'" class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs font-medium">
                                        <i class="fas fa-check mr-1"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß
                                    </span>
                                    <span x-show="slip.verification_status === 'rejected'" class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs font-medium">
                                        <i class="fas fa-times mr-1"></i>‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                                    </span>
                                </div>
                            </div>
                            
                            <!-- Slip Details -->
                            <div class="p-4">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h3 class="font-semibold text-gray-900" x-text="slip.order_number"></h3>
                                        <p class="text-sm text-gray-500" x-text="formatDate(slip.uploaded_at || slip.timestamp)"></p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-lg font-bold text-green-600" x-text="'‡∏ø' + slip.amount?.toLocaleString()"></p>
                                    </div>
                                </div>
                                
                                <div class="text-sm text-gray-600 mb-4">
                                    <p><strong>‡πÑ‡∏ü‡∏•‡πå:</strong> <span x-text="slip.file_name || 'N/A'"></span></p>
                                    <p><strong>‡∏Ç‡∏ô‡∏≤‡∏î:</strong> <span x-text="slip.file_size ? (slip.file_size / 1024).toFixed(1) + ' KB' : 'N/A'"></span></p>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="flex space-x-2">
                                    <template x-if="slip.verification_status === 'pending'">
                                        <div class="flex space-x-2 w-full">
                                            <button @click="approveSlip(slip)" class="flex-1 bg-green-500 text-white py-2 px-3 rounded text-sm hover:bg-green-600 transition-colors">
                                                <i class="fas fa-check mr-1"></i>‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                            </button>
                                            <button @click="deleteSlip(slip)" class="flex-1 bg-red-500 text-white py-2 px-3 rounded text-sm hover:bg-red-600 transition-colors">
                                                <i class="fas fa-trash mr-1"></i>‡∏•‡∏ö
                                            </button>
                                        </div>
                                    </template>
                                    
                                    <template x-if="slip.verification_status === 'approved'">
                                        <div class="flex space-x-2 w-full">
                                            <button @click="showShippingForm(slip)" class="flex-1 bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600 transition-colors">
                                                <i class="fas fa-shipping-fast mr-1"></i>‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
                                            </button>
                                            <button @click="deleteSlip(slip)" class="bg-red-500 text-white py-2 px-3 rounded text-sm hover:bg-red-600 transition-colors">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </template>
                                    
                                    <template x-if="slip.verification_status === 'rejected'">
                                        <button @click="deleteSlip(slip)" class="w-full bg-red-500 text-white py-2 px-3 rounded text-sm hover:bg-red-600 transition-colors">
                                            <i class="fas fa-trash mr-1"></i>‡∏•‡∏ö
                                        </button>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
                
                <!-- Empty State -->
                <div x-show="paymentSlips.length === 0" class="text-center py-12">
                    <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-receipt text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</h3>
                    <p class="text-gray-500">‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏•‡∏¥‡∏õ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô ‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
                </div>
            </div>

            <!-- ========================== -->
            <!-- üì¶ INVENTORY TAB -->
            <!-- ========================== -->
            <div x-show="currentTab === 'inventory' && !loading">
                <div class="flex justify-between items-center mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">üì¶ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                        <p class="text-gray-600 mt-1">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡πÄ‡∏û‡∏¥‡πà‡∏° ‡∏•‡∏î ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                    </div>
                    <div class="flex space-x-3">
                        <button @click="refreshStock()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                            <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                        <button @click="exportStockReport()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors">
                            <i class="fas fa-download mr-2"></i>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                        </button>
                    </div>
                </div>
                
                <!-- Stock Stats -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-blue-100 rounded-lg">
                                <i class="fas fa-boxes text-blue-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="stockData.length"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-green-100 rounded-lg">
                                <i class="fas fa-warehouse text-green-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏£‡∏ß‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="getTotalStock()"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-yellow-100 rounded-lg">
                                <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="getLowStockCount()"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-sm">
                        <div class="flex items-center">
                            <div class="p-2 bg-purple-100 rounded-lg">
                                <i class="fas fa-dollar-sign text-purple-600"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡∏™‡∏ï‡πá‡∏≠‡∏Å</p>
                                <p class="text-2xl font-bold text-gray-900" x-text="'‡∏ø' + getStockValue().toLocaleString()"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stock Table -->
                <div class="bg-white shadow-sm rounded-lg overflow-hidden">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-medium text-gray-900">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="product in stockData" :key="product.id">
                                    <tr class="hover:bg-gray-50" :class="{'bg-red-50': product.stock <= (product.min_stock || 0)}">
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm font-medium text-gray-900" x-text="product.name"></div>
                                            <div class="text-sm text-gray-500" x-text="'ID: ' + product.id"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="product.stock <= (product.min_stock || 0) ? 'text-red-600 font-bold' : 'text-gray-900'" 
                                                  x-text="product.stock"></span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="product.min_stock || 0"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="'‡∏ø' + (product.price || 0).toLocaleString()"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="'‡∏ø' + ((product.stock || 0) * (product.price || 0)).toLocaleString()"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span x-show="product.stock > (product.min_stock || 0)" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                                ‡∏õ‡∏Å‡∏ï‡∏¥
                                            </span>
                                            <span x-show="product.stock <= (product.min_stock || 0) && product.stock > 0" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                ‡∏ï‡πà‡∏≥
                                            </span>
                                            <span x-show="product.stock === 0" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                                ‡∏´‡∏°‡∏î
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                            <button @click="showStockAdjustment(product)" class="text-blue-600 hover:text-blue-900">
                                                <i class="fas fa-edit mr-1"></i>‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å
                                            </button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Empty State -->
                <div x-show="stockData.length === 0" class="text-center py-12">
                    <div class="mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-boxes text-gray-400 text-3xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å</h3>
                    <p class="text-gray-500">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</p>
                </div>
            </div>

            <!-- ========================== -->
            <!-- üõí OTHER TABS -->
            <!-- ========================== -->
            
            <!-- Orders Tab -->
            <div x-show="currentTab === 'orders' && !loading">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üõí ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h2>
                    <button @click="refreshOrders()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                </div>
                
                <div class="bg-white shadow-sm rounded-lg overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="order in orders" :key="order.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="order.customer_id || order.id || 'N/A'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <div class="text-sm text-gray-900" x-text="order.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'"></div>
                                            <div class="text-sm text-gray-500" x-text="order.email || ''"></div>
                                            <div class="text-sm text-gray-500" x-text="order.phone || ''"></div>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="(order.quantity || 1) + ' ‡∏ã‡∏≠‡∏á'"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="'‡∏ø' + (order.total_amount || 0)?.toLocaleString()"></td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(order.created_at || order.timestamp)"></td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                                ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                                            </span>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- POS Tab -->
            <div x-show="currentTab === 'pos' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üí∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏¢‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô (POS)</h2>
                    <p class="text-gray-600 mt-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≤‡∏¢‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏£‡πâ‡∏≤‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <div class="mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-cash-register text-green-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">‡∏£‡∏∞‡∏ö‡∏ö POS ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</h3>
                    <p class="text-gray-500 mb-4">‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏£‡∏∞‡∏ö‡∏ö POS ‡πÅ‡∏¢‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏≤‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå POS ‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ</p>
                    <button class="bg-green-500 text-white px-6 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-external-link-alt mr-2"></i>‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏ö‡∏ö POS
                    </button>
                </div>
            </div>

            <!-- Contacts Tab -->
            <div x-show="currentTab === 'contacts' && !loading">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üìß ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h2>
                    <button @click="refreshContacts()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                    </button>
                </div>
                
                <div class="space-y-4">
                    <template x-for="contact in contacts" :key="contact.id">
                        <div class="bg-white shadow-sm rounded-lg p-6">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-900" x-text="contact.name || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠'"></h3>
                                    <p class="text-gray-600" x-text="(contact.email || '') + ' ‚Ä¢ ' + (contact.phone || '')"></p>
                                    <p class="text-sm text-gray-500" x-text="formatDate(contact.timestamp)"></p>
                                </div>
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">‡πÉ‡∏´‡∏°‡πà</span>
                            </div>
                            <div class="text-gray-800" x-text="contact.message || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°'"></div>
                        </div>
                    </template>
                </div>
            </div>

            <!-- Reports Tab -->
            <div x-show="currentTab === 'reports' && !loading">
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-900">üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</h2>
                    <p class="text-gray-600 mt-1">‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡πà‡∏≤‡∏á ‡πÜ</p>
                </div>
                
                <div class="bg-white p-6 rounded-lg shadow-sm text-center">
                    <div class="mx-auto w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mb-4">
                        <i class="fas fa-chart-line text-purple-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á</h3>
                    <p class="text-gray-500 mb-4">‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á‡∏à‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡πÉ‡∏ô‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</p>
                    <button class="bg-purple-500 text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors">
                        <i class="fas fa-coming-soon mr-2"></i>‡πÄ‡∏£‡πá‡∏ß ‡πÜ ‡∏ô‡∏µ‡πâ
                    </button>
                </div>
            </div>

        </main>
    </div>

    <!-- ========================== -->
    <!-- ü™ü MODALS -->
    <!-- ========================== -->
    
    <!-- Slip Image Modal -->
    <div x-show="showSlipModal" 
         x-transition:enter="transition ease-out duration-300" 
         x-transition:enter-start="opacity-0" 
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200" 
         x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         @click.self="showSlipModal = false">
        <div class="flex items-center justify-center min-h-screen px-4 modal-backdrop">
            <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-screen overflow-y-auto">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-lg font-medium text-gray-900" x-text="'‡∏™‡∏•‡∏¥‡∏õ ' + selectedSlip?.order_number"></h3>
                    <button @click="showSlipModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <template x-if="selectedSlip">
                        <div>
                            <img :src="selectedSlip.image_url || ('data:' + selectedSlip.file_type + ';base64,' + selectedSlip.file_data)" 
                                 class="w-full h-auto max-h-96 object-contain rounded-lg mb-4" 
                                 alt="Payment Slip">
                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div>
                                    <strong>‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠:</strong> 
                                    <span x-text="selectedSlip.order_number"></span>
                                </div>
                                <div>
                                    <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> 
                                    <span x-text="'‡∏ø' + selectedSlip.amount?.toLocaleString()"></span>
                                </div>
                                <div>
                                    <strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î:</strong> 
                                    <span x-text="formatDate(selectedSlip.uploaded_at)"></span>
                                </div>
                                <div>
                                    <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> 
                                    <span x-text="selectedSlip.verification_status === 'pending' ? '‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö' : 
                                                   selectedSlip.verification_status === 'approved' ? '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß' : '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò'"></span>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Shipping Form Modal -->
    <div x-show="showShippingModal" 
         x-transition:enter="transition ease-out duration-300" 
         x-transition:enter-start="opacity-0" 
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200" 
         x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         @click.self="showShippingModal = false">
        <div class="flex items-center justify-center min-h-screen px-4 modal-backdrop">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-lg font-medium text-gray-900">üöö ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
                    <button @click="showShippingModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <template x-if="selectedSlip">
                        <div>
                            <div class="mb-4 p-3 bg-green-50 rounded-lg">
                                <div class="text-sm text-gray-600">‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</div>
                                <div class="font-medium" x-text="selectedSlip.order_number"></div>
                                <div class="text-sm text-green-600" x-text="'‡∏ø' + selectedSlip.amount?.toLocaleString()"></div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏:</label>
                                    <input type="text" x-model="shippingForm.tracking_number" 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                           placeholder="VV1234567890TH">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô):</label>
                                    <textarea x-model="shippingForm.notes" rows="3"
                                              class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                              placeholder="‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤..."></textarea>
                                </div>
                            </div>
                            
                            <div class="mt-6 flex space-x-3">
                                <button @click="submitShipping()" :disabled="!shippingForm.tracking_number || shippingLoading"
                                        class="flex-1 bg-green-500 text-white py-2 px-4 rounded-lg hover:bg-green-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span x-show="!shippingLoading">
                                        <i class="fas fa-paper-plane mr-2"></i>‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏
                                    </span>
                                    <span x-show="shippingLoading" class="flex items-center justify-center">
                                        <div class="loading mr-2"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...
                                    </span>
                                </button>
                                <button @click="showShippingModal = false" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <!-- Stock Adjustment Modal -->
    <div x-show="showStockModal" 
         x-transition:enter="transition ease-out duration-300" 
         x-transition:enter-start="opacity-0" 
         x-transition:enter-end="opacity-100"
         x-transition:leave="transition ease-in duration-200" 
         x-transition:leave-start="opacity-100" 
         x-transition:leave-end="opacity-0"
         class="fixed inset-0 z-50 overflow-y-auto" 
         @click.self="showStockModal = false">
        <div class="flex items-center justify-center min-h-screen px-4 modal-backdrop">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full">
                <div class="flex justify-between items-center p-6 border-b">
                    <h3 class="text-lg font-medium text-gray-900">üì¶ ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                    <button @click="showStockModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6">
                    <template x-if="selectedProduct">
                        <div>
                            <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                                <div class="font-medium" x-text="selectedProduct.name"></div>
                                <div class="text-sm text-gray-600" x-text="'ID: ' + selectedProduct.id"></div>
                                <div class="text-lg font-bold text-blue-600 mt-1" x-text="'‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ' + selectedProduct.stock"></div>
                            </div>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö:</label>
                                    <select x-model="stockForm.type" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                        <option value="add">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                                        <option value="reduce">‚ûñ ‡∏•‡∏î‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                                        <option value="set">üéØ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô:</label>
                                    <input type="number" x-model="stockForm.amount" min="0"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                           placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô">
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</label>
                                    <select x-model="stockForm.reason" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                        <option value="‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà">‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</option>
                                        <option value="‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢">‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢</option>
                                        <option value="‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢</option>
                                        <option value="‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å">‡∏ô‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å</option>
                                        <option value="‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤">‡∏Ñ‡∏∑‡∏ô‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                                        <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                                    </select>
                                </div>
                                
                                <div x-show="stockForm.reason === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ'">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•:</label>
                                    <input type="text" x-model="stockForm.customReason"
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                                           placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•...">
                                </div>
                            </div>
                            
                            <div class="mt-6 flex space-x-3">
                                <button @click="submitStockAdjustment()" :disabled="!stockForm.amount || stockLoading"
                                        class="flex-1 bg-blue-500 text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                                    <span x-show="!stockLoading">
                                        <i class="fas fa-check mr-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö
                                    </span>
                                    <span x-show="stockLoading" class="flex items-center justify-center">
                                        <div class="loading mr-2"></div>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£...
                                    </span>
                                </button>
                                <button @click="showStockModal = false" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                    ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========================== 
        // üß† MAIN APP LOGIC
        // ==========================
        function adminApp() {
            return {
                // ‚öôÔ∏è Configuration
                API_URL: 'https://script.google.com/macros/s/AKfycbwoEN86QTpuRxDckf8mQiga9pkn-RJBM0z00nqywbPUbeeIR34XX6JPHQeVcuLoWKAeUA/exec',
                SHEETS_URL: 'https://docs.google.com/spreadsheets/d/19jd3hyPBVrwvbqv28uUv47GjoPYcfVv-_1XcZH548I4/edit',
                
                // üîê Authentication State
                isAuthenticated: false,
                userEmail: '',
                loginForm: { email: 'admin@veevee.com', password: '' },
                loginLoading: false,
                loginError: '',
                
                // üß≠ Navigation State
                currentTab: 'slips',
                loading: false,
                
                // üìä Data State
                orders: [],
                contacts: [],
                paymentSlips: [],
                stockData: [],
                
                // ü™ü Modal State
                showSlipModal: false,
                showShippingModal: false,
                showStockModal: false,
                selectedSlip: null,
                selectedProduct: null,
                
                // üìù Form State
                shippingForm: { tracking_number: '', notes: '' },
                stockForm: { type: 'add', amount: '', reason: '‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà', customReason: '' },
                shippingLoading: false,
                stockLoading: false,
                
                // üßÆ Computed Properties
                get pendingSlips() {
                    return this.paymentSlips.filter(slip => slip.verification_status === 'pending').length;
                },
                
                get approvedSlips() {
                    return this.paymentSlips.filter(slip => slip.verification_status === 'approved').length;
                },
                
                getTotalStock() {
                    return this.stockData.reduce((sum, product) => sum + (product.stock || 0), 0);
                },
                
                getLowStockCount() {
                    return this.stockData.filter(product => (product.stock || 0) <= (product.min_stock || 0)).length;
                },
                
                getStockValue() {
                    return this.stockData.reduce((sum, product) => sum + ((product.stock || 0) * (product.price || 0)), 0);
                },
                
                getTodaySlipAmount() {
                    const today = new Date().toDateString();
                    return this.paymentSlips
                        .filter(slip => new Date(slip.uploaded_at || slip.timestamp).toDateString() === today)
                        .reduce((sum, slip) => sum + (slip.amount || 0), 0);
                },

                // üöÄ Initialization
                async init() {
                    console.log('üõ°Ô∏è VeeVee Admin Panel - Perfect Edition');
                    
                    let retryCount = 0;
                    const maxRetries = 10;
                    
                    const waitForFirebase = () => {
                        return new Promise((resolve) => {
                            const checkFirebase = () => {
                                if (window.firebaseAuth && window.firebaseOnAuthStateChanged) {
                                    console.log('‚úÖ Firebase ready!');
                                    resolve(true);
                                } else if (retryCount < maxRetries) {
                                    retryCount++;
                                    console.log(`‚è≥ Waiting for Firebase... (${retryCount}/${maxRetries})`);
                                    setTimeout(checkFirebase, 500);
                                } else {
                                    console.warn('‚ö†Ô∏è Firebase timeout, continuing without auth');
                                    resolve(false);
                                }
                            };
                            checkFirebase();
                        });
                    };

                    const firebaseReady = await waitForFirebase();
                    
                    if (firebaseReady) {
                        try {
                            window.firebaseOnAuthStateChanged(window.firebaseAuth, (user) => {
                                if (user) {
                                    console.log('‚úÖ User authenticated:', user.email);
                                    this.isAuthenticated = true;
                                    this.userEmail = user.email;
                                    this.loadAllData();
                                } else {
                                    console.log('üö™ User not authenticated');
                                    this.isAuthenticated = false;
                                    this.userEmail = '';
                                }
                            });
                        } catch (error) {
                            console.error('‚ùå Auth listener error:', error);
                        }
                    }
                },
                
                // üîê Authentication Functions
                async login() {
                    this.loginLoading = true;
                    this.loginError = '';
                    
                    try {
                        console.log('üîê Attempting login...');
                        
                        if (!window.firebaseSignInWithEmailAndPassword || !window.firebaseAuth) {
                            throw new Error('Firebase Authentication ‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
                        }
                        
                        const userCredential = await window.firebaseSignInWithEmailAndPassword(
                            window.firebaseAuth,
                            this.loginForm.email,
                            this.loginForm.password
                        );
                        
                        console.log('‚úÖ Admin logged in:', userCredential.user.email);
                        
                        this.isAuthenticated = true;
                        this.userEmail = userCredential.user.email;
                        
                        showNotification('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ' + this.userEmail, 'success');
                        
                        setTimeout(() => {
                            this.loadAllData();
                        }, 500);
                        
                    } catch (error) {
                        console.error('‚ùå Login failed:', error);
                        
                        if (error.code === 'auth/user-not-found') {
                            this.loginError = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö';
                        } else if (error.code === 'auth/wrong-password') {
                            this.loginError = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                        } else if (error.code === 'auth/invalid-email') {
                            this.loginError = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
                        } else {
                            this.loginError = '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                        }
                    } finally {
                        this.loginLoading = false;
                    }
                },
                
                async logout() {
                    try {
                        if (window.firebaseSignOut && window.firebaseAuth) {
                            await window.firebaseSignOut(window.firebaseAuth);
                        }
                        this.isAuthenticated = false;
                        this.userEmail = '';
                        showNotification('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                        console.log('‚úÖ Admin logged out');
                    } catch (error) {
                        console.error('‚ùå Logout failed:', error);
                        this.isAuthenticated = false;
                        this.userEmail = '';
                    }
                },

                // üìä Data Loading Functions
                async loadAllData() {
                    this.loading = true;
                    try {
                        await Promise.all([
                            this.refreshPaymentSlips(),
                            this.refreshOrders(),
                            this.refreshContacts(),
                            this.refreshStock()
                        ]);
                        console.log('‚úÖ All data loaded successfully');
                    } catch (error) {
                        console.error('‚ùå Failed to load data:', error);
                        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async refreshPaymentSlips() {
                    try {
                        const response = await this.callAPI('get_slips');
                        if (response.success) {
                            this.paymentSlips = response.data || [];
                            console.log('‚úÖ Payment slips loaded:', this.paymentSlips.length);
                        }
                    } catch (error) {
                        console.error('‚ùå Failed to load payment slips:', error);
                    }
                },

                async refreshOrders() {
                    try {
                        const response = await this.callAPI('get_orders');
                        if (response.success) {
                            this.orders = response.data || [];
                            console.log('‚úÖ Orders loaded:', this.orders.length);
                        }
                    } catch (error) {
                        console.error('‚ùå Failed to load orders:', error);
                    }
                },

                async refreshContacts() {
                    try {
                        const response = await this.callAPI('get_contacts');
                        if (response.success) {
                            this.contacts = response.data || [];
                            console.log('‚úÖ Contacts loaded:', this.contacts.length);
                        }
                    } catch (error) {
                        console.error('‚ùå Failed to load contacts:', error);
                    }
                },

                async refreshStock() {
                    try {
                        const response = await this.callAPI('get_stock');
                        if (response.success) {
                            this.stockData = response.data.products || [];
                            console.log('‚úÖ Stock data loaded:', this.stockData.length);
                        }
                    } catch (error) {
                        console.error('‚ùå Failed to load stock data:', error);
                    }
                },

                // üßæ Payment Slip Functions
                async approveSlip(slip) {
                    try {
                        const confirmation = confirm(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô\n‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ‡∏ø${slip.amount?.toLocaleString()}\n‡∏£‡∏´‡∏±‡∏™‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠: ${slip.order_number}\n\n‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥?`);
                        
                        if (!confirmation) return;
                        
                        const response = await this.callAPI('approve_slip', {
                            slip_id: slip.id,
                            order_number: slip.order_number,
                            admin_notes: '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏∞‡∏ö‡∏ö Admin'
                        });
                        
                        if (response.success) {
                            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÉ‡∏ô Firebase
                            if (window.firebaseDoc && window.firebaseUpdateDoc && window.firebaseDb) {
                                try {
                                    const slipRef = window.firebaseDoc(window.firebaseDb, 'payment_slips', slip.id);
                                    await window.firebaseUpdateDoc(slipRef, {
                                        verification_status: 'approved',
                                        approved_at: new Date().toISOString(),
                                        approved_by: this.userEmail
                                    });
                                    console.log('üî• Slip approved in Firebase');
                                } catch (firebaseError) {
                                    console.warn('‚ö†Ô∏è Firebase update failed:', firebaseError);
                                }
                            }
                            
                            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï local state
                            const slipIndex = this.paymentSlips.findIndex(s => s.id === slip.id);
                            if (slipIndex !== -1) {
                                this.paymentSlips[slipIndex].verification_status = 'approved';
                                this.paymentSlips[slipIndex].approved_at = new Date().toISOString();
                                this.paymentSlips[slipIndex].approved_by = this.userEmail;
                            }
                            
                            showNotification(`‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏•‡∏¥‡∏õ ${slip.order_number} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                        } else {
                            showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏•‡∏¥‡∏õ: ' + response.message, 'error');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Failed to approve slip:', error);
                        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏•‡∏¥‡∏õ', 'error');
                    }
                },

                async deleteSlip(slip) {
                    try {
                        const confirmation = confirm(`‡∏•‡∏ö‡∏™‡∏•‡∏¥‡∏õ ${slip.order_number}?\n\n‚ö†Ô∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ`);
                        
                        if (!confirmation) return;
                        
                        const response = await this.callAPI('delete_slip', {
                            slip_id: slip.id
                        });
                        
                        if (response.success) {
                            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å Firebase
                            if (window.firebaseDoc && window.firebaseDeleteDoc && window.firebaseDb) {
                                try {
                                    const slipRef = window.firebaseDoc(window.firebaseDb, 'payment_slips', slip.id);
                                    await window.firebaseDeleteDoc(slipRef);
                                    console.log('üî• Slip deleted from Firebase');
                                } catch (firebaseError) {
                                    console.warn('‚ö†Ô∏è Firebase delete failed:', firebaseError);
                                }
                            }
                            
                            // ‡∏•‡∏ö‡∏à‡∏≤‡∏Å local state
                            const slipIndex = this.paymentSlips.findIndex(s => s.id === slip.id);
                            if (slipIndex !== -1) {
                                this.paymentSlips.splice(slipIndex, 1);
                            }
                            
                            showNotification(`üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏•‡∏¥‡∏õ ${slip.order_number} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                        } else {
                            showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏•‡∏¥‡∏õ: ' + response.message, 'error');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Failed to delete slip:', error);
                        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏•‡∏¥‡∏õ', 'error');
                    }
                },

                async bulkApproveSlips() {
                    const pendingSlips = this.paymentSlips.filter(slip => slip.verification_status === 'pending');
                    
                    if (pendingSlips.length === 0) {
                        showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'warning');
                        return;
                    }
                    
                    const confirmation = confirm(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${pendingSlips.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?\n\n‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ó‡∏∏‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`);
                    
                    if (!confirmation) return;
                    
                    let approved = 0;
                    let errors = 0;
                    
                    for (const slip of pendingSlips) {
                        try {
                            await this.approveSlip(slip);
                            approved++;
                        } catch (error) {
                            errors++;
                            console.error('Failed to approve slip:', slip.id, error);
                        }
                    }
                    
                    showNotification(`‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏•‡∏¥‡∏õ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢ ${approved} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£` + (errors > 0 ? ` (‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ${errors} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)` : ''), 'success');
                },

                // ü™ü Modal Functions
                viewSlipImage(slip) {
                    this.selectedSlip = slip;
                    this.showSlipModal = true;
                },

                showShippingForm(slip) {
                    this.selectedSlip = slip;
                    this.shippingForm = { tracking_number: '', notes: '' };
                    this.showShippingModal = true;
                },

                async submitShipping() {
                    if (!this.shippingForm.tracking_number.trim()) {
                        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏', 'warning');
                        return;
                    }
                    
                    this.shippingLoading = true;
                    
                    try {
                        const response = await this.callAPI('update_shipping', {
                            order_number: this.selectedSlip.order_number,
                            tracking_number: this.shippingForm.tracking_number.trim(),
                            shipping_notes: this.shippingForm.notes.trim()
                        });
                        
                        if (response.success) {
                            showNotification(`üì¶ ‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏ ${this.selectedSlip.order_number} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏•‡∏Ç‡∏û‡∏±‡∏™‡∏î‡∏∏‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡πâ‡∏ß`, 'success');
                            this.showShippingModal = false;
                        } else {
                            showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏: ' + response.message, 'error');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Failed to update shipping:', error);
                        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏û‡∏±‡∏™‡∏î‡∏∏', 'error');
                    } finally {
                        this.shippingLoading = false;
                    }
                },

                // üì¶ Stock Management Functions
                showStockAdjustment(product) {
                    this.selectedProduct = product;
                    this.stockForm = { type: 'add', amount: '', reason: '‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà', customReason: '' };
                    this.showStockModal = true;
                },

                async submitStockAdjustment() {
                    if (!this.stockForm.amount || this.stockForm.amount <= 0) {
                        showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'warning');
                        return;
                    }
                    
                    this.stockLoading = true;
                    
                    try {
                        let adjustment;
                        const amount = parseInt(this.stockForm.amount);
                        
                        switch (this.stockForm.type) {
                            case 'add':
                                adjustment = amount;
                                break;
                            case 'reduce':
                                adjustment = -amount;
                                if (this.selectedProduct.stock + adjustment < 0) {
                                    showNotification('‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏•‡∏î', 'warning');
                                    this.stockLoading = false;
                                    return;
                                }
                                break;
                            case 'set':
                                adjustment = amount - this.selectedProduct.stock;
                                break;
                        }
                        
                        const finalReason = this.stockForm.reason === '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' ? this.stockForm.customReason : this.stockForm.reason;
                        
                        if (!finalReason) {
                            showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•', 'warning');
                            this.stockLoading = false;
                            return;
                        }
                        
                        const response = await this.callAPI('update_stock', {
                            product_id: this.selectedProduct.id,
                            adjustment: adjustment,
                            reason: finalReason
                        });
                        
                        if (response.success) {
                            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï local state
                            const productIndex = this.stockData.findIndex(p => p.id === this.selectedProduct.id);
                            if (productIndex !== -1) {
                                this.stockData[productIndex].stock = response.data.new_stock;
                            }
                            
                            showNotification(`‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å ${this.selectedProduct.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß\n‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÉ‡∏´‡∏°‡πà: ${response.data.new_stock}`, 'success');
                            this.showStockModal = false;
                        } else {
                            showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å: ' + response.message, 'error');
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Failed to adjust stock:', error);
                        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ï‡πá‡∏≠‡∏Å', 'error');
                    } finally {
                        this.stockLoading = false;
                    }
                },

                // üìä Utility Functions
                async callAPI(action, data = {}) {
                    try {
                        const response = await fetch(this.API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                action: action,
                                ...data,
                                admin_auth: this.userEmail,
                                timestamp: new Date().toISOString()
                            }),
                            mode: 'cors'
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        const result = await response.json();
                        console.log(`‚úÖ API ${action} response:`, result);
                        
                        return result;

                    } catch (error) {
                        console.error(`‚ùå API ${action} Error:`, error);
                        return { 
                            success: false, 
                            message: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ',
                            error: error.message 
                        };
                    }
                },

                openGoogleSheets() {
                    if (this.SHEETS_URL) {
                        window.open(this.SHEETS_URL, '_blank');
                    } else {
                        showNotification('Google Sheets URL ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤', 'warning');
                    }
                },

                formatDate(timestamp) {
                    if (!timestamp) return 'N/A';
                    const date = new Date(timestamp.seconds ? timestamp.seconds * 1000 : timestamp);
                    return date.toLocaleDateString('th-TH') + ' ' + date.toLocaleTimeString('th-TH');
                },

                exportStockReport() {
                    try {
                        let csvContent = '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ VeeVee\n';
                        csvContent += `‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${new Date().toLocaleString('th-TH')}\n`;
                        csvContent += `‡∏ú‡∏π‡πâ‡∏™‡∏£‡πâ‡∏≤‡∏á: ${this.userEmail}\n\n`;
                        
                        csvContent += 'ID,‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤,‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô,‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥,‡∏£‡∏≤‡∏Ñ‡∏≤,‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞\n';
                        
                        this.stockData.forEach(product => {
                            const value = (product.stock || 0) * (product.price || 0);
                            const status = (product.stock || 0) <= (product.min_stock || 0) ? '‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥' : '‡∏õ‡∏Å‡∏ï‡∏¥';
                            csvContent += `${product.id},${product.name},${product.stock || 0},${product.min_stock || 0},${product.price || 0},${value},${status}\n`;
                        });
                        
                        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                        const link = document.createElement('a');
                        const url = URL.createObjectURL(blob);
                        link.setAttribute('href', url);
                        link.setAttribute('download', `VeeVee-Stock-Report-${new Date().toISOString().split('T')[0]}.csv`);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                        
                    } catch (error) {
                        console.error('Export failed:', error);
                        showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'error');
                    }
                }
            }
        }

        // ========================== 
        // üîî NOTIFICATION SYSTEM
        // ==========================
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notification-icon');
            const messageElement = document.getElementById('notification-message');
            
            // Set icon based on type
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            icon.className = icons[type] || icons.info;
            messageElement.textContent = message;
            
            // Remove existing type classes and add new one
            notification.className = `notification ${type}`;
            
            // Show notification
            notification.classList.add('show');
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                hideNotification();
            }, 5000);
        }

        function hideNotification() {
            const notification = document.getElementById('notification');
            notification.classList.remove('show');
        }

        // ========================== 
        // üöÄ INITIALIZE APP
        // ==========================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ VeeVee Admin Panel - Perfect Edition Loaded!');
        });
    </script>
</body>
</html>